<!DOCTYPE html>
<html>
  <head>
    <title>Test Iframe</title>
  </head>
  <body>
    Test Iframe

    <script>
      window.onerror = function () {
        console.log.apply(console, arguments);
      };
    </script>
    <script src="/penpal.js"></script>
    <script>
      let channelBParent;

      const channelBMessenger = new Penpal.WindowMessenger({
        remoteWindow: window.parent,
        remoteOrigin: '*',
        channel: 'B',
        log: Penpal.debug('Child Connection B'),
      });

      const channelBMethods = {
        getChannel() {
          return 'B';
        },
        getChannelFromParent() {
          return channelBParent.getChannel();
        },
      };

      Penpal.connectToParent({
        messenger: channelBMessenger,
        methods: channelBMethods,
      }).promise.then((parent) => {
        channelBParent = parent;
      });

      let channelAParent;

      const channelAMessenger = new Penpal.WindowMessenger({
        remoteWindow: window.parent,
        remoteOrigin: '*',
        channel: 'A',
        log: Penpal.debug('Child Connection A'),
      });

      const channelAMethods = {
        getChannel() {
          return 'A';
        },
        getChannelFromParent() {
          return channelAParent.getChannel();
        },
      };

      Penpal.connectToParent({
        messenger: channelAMessenger,
        methods: channelAMethods,
      }).promise.then((parent) => {
        channelAParent = parent;
      });
    </script>
  </body>
</html>
